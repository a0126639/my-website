<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>商品區裁切（修正版）</title>
  <style>
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; }
    body {
      font-family: Arial, sans-serif;
      display: grid;
      grid-template-columns: 200px 1fr 250px;
      height: 100vh;
      overflow: hidden;
    }

    /* 左側 */
    nav {
      background:#f0f0f0;
      padding:12px;
      border-right:1px solid #ccc;
    }
    nav a { display:block; margin:8px 0; color:#333; text-decoration:none; }

    /* 中間 main（定位容器） */
    main {
      position: relative;   /* 重要：frame-wrap 的 absolute 以此為參考 */
      background: #fff;
      overflow: hidden;
    }

    /* 右側 */
    aside {
      background:#fafafa;
      padding:12px;
      border-left:1px solid #ccc;
      overflow-y:auto;
    }

    .ad-box { background:#e0e0e0; padding:10px; margin-bottom:10px; text-align:center; }

    /* 裁切容器（可調高度）*/
    .frame-wrap {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      overflow: hidden;
      /* height 由 JS 設定 */
    }

    /* iframe 本體 - 以 transform 移動，不改變 iframe 的內部寬度 */
    iframe.frame-inner {
      width: 100%;
      height: 2000px; /* iframe 本體高度要足夠大以便移動裁切 */
      border: 0;
      display: block;
      transform-origin: 0 0;
      -webkit-transform-origin: 0 0;
    }

    /* 控制面板，放在 main 左上方 */
    .panel {
      position: absolute;
      left: 10px;
      top: 10px;
      z-index: 9999;
      background: rgba(255,255,255,0.95);
      padding:10px;
      border-radius:6px;
      border:1px solid #ddd;
      width: 380px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      font-size:14px;
    }
    .panel h4 { margin:0 0 6px 0; font-size:15px; }
    .panel label { display:block; margin-top:8px; font-size:13px; }
    .panel input[type="range"] { width:100%; }
    .small { font-size:12px; color:#666; margin-top:6px; }

    .btn { display:inline-block; padding:6px 10px; margin-top:8px; background:#007bff; color:#fff; text-decoration:none; border-radius:4px; }
    .btn.green { background:#28a745; margin-left:8px; }

    .notice { margin-top:8px; color:#a00; font-size:13px; display:none; }

    /* 備援提醒 */
    #fallback { padding:16px; display:none; }
  </style>
</head>
<body>
  <nav>
    <h3>網站導覽</h3>
    <a href="https://www.google.com" target="_blank">Google</a>
    <a href="https://www.youtube.com" target="_blank">YouTube</a>
    <a href="https://www.jljh.com.tw/" target="_blank">嘉隆首頁</a>
  </nav>

  <main id="main">
    <!-- 控制面板 -->
    <div class="panel" id="panel">
      <h4>裁切工具（調整後記下數值）</h4>

      <label>水平位移（translateX）: <span id="xVal">0</span> px</label>
      <input id="xRange" type="range" min="-300" max="300" value="0" step="1">

      <label>垂直位移（向上移為負，translateY）: <span id="yVal">-300</span> px</label>
      <input id="yRange" type="range" min="-2000" max="0" value="-300" step="1">

      <label>顯示高度（裁切視窗高度）: <span id="hVal">800</span> px</label>
      <input id="hRange" type="range" min="200" max="2000" value="800" step="10">

      <div class="small">拖拉三個滑桿直到畫面只顯示商品紅框區。記下三個數字 (x, y, height)。</div>

      <a id="applyBtn" class="btn" href="#">顯示目前設定</a>
      <a id="openNewBtn" class="btn green" target="_blank" href="https://www.jljh.com.tw/usedcust/index.php?t=1&npg=">在新分頁開啟原站</a>

      <div class="notice" id="notice">iframe 載入似乎有問題（可能被阻擋或第三方 cookie）。</div>
    </div>

    <!-- 裁切容器 -->
    <div class="frame-wrap" id="frameWrap" style="height:800px;">
      <iframe id="theFrame" class="frame-inner"
        src="https://www.jljh.com.tw/usedcust/index.php?t=1&npg="
        title="嘉隆商品區" scrolling="no"></iframe>
    </div>

    <!-- 如果 iframe 被擋或無法載入，顯示備援 -->
    <div id="fallback">
      <strong>提醒：</strong> 無法在本頁嵌入該網站（iframe 被禁止或網路阻擋）。請按「在新分頁開啟原站」。
    </div>
  </main>

  <aside>
    <h3>廣告區</h3>
    <div class="ad-box">這裡可以放你的廣告 1</div>
    <div class="ad-box">廣告 2</div>
    <div class="ad-box">或 Google AdSense</div>
  </aside>

  <script>
    // 元件
    const xRange = document.getElementById('xRange');
    const yRange = document.getElementById('yRange');
    const hRange = document.getElementById('hRange');
    const xVal = document.getElementById('xVal');
    const yVal = document.getElementById('yVal');
    const hVal = document.getElementById('hVal');
    const frameWrap = document.getElementById('frameWrap');
    const theFrame = document.getElementById('theFrame');
    const notice = document.getElementById('notice');
    const fallback = document.getElementById('fallback');

    // 初始值
    let tx = parseInt(xRange.value, 10);
    let ty = parseInt(yRange.value, 10);
    let vh = parseInt(hRange.value, 10);

    function update() {
      xVal.textContent = tx;
      yVal.textContent = ty;
      hVal.textContent = vh;
      frameWrap.style.height = vh + 'px';
      // 合併 transform: translateX + translateY
      theFrame.style.transform = 'translate(' + tx + 'px, ' + ty + 'px)';
      // 如果 iframe 太短，增加高度（確保能往上移）
      if (theFrame.clientHeight < Math.abs(ty) + 300) {
        theFrame.style.height = (Math.abs(ty) + vh + 500) + 'px';
      }
    }

    xRange.addEventListener('input', (e) => { tx = parseInt(e.target.value,10); update(); });
    yRange.addEventListener('input', (e) => { ty = parseInt(e.target.value,10); update(); });
    hRange.addEventListener('input', (e) => { vh = parseInt(e.target.value,10); update(); });

    document.getElementById('applyBtn').addEventListener('click', (e) => {
      e.preventDefault();
      alert('目前設定：\n水平 x = ' + tx + ' px\n垂直 y = ' + ty + ' px\n高度 h = ' + vh + ' px\n\n把這三個數字記下來，我可以幫你把他寫死到頁面。');
    });

    // 偵測 iframe 能否載入（5 秒內沒 load 視為失敗）
    let loaded = false;
    theFrame.addEventListener('load', () => {
      loaded = true;
      notice.style.display = 'none';
      fallback.style.display = 'none';
    });
    setTimeout(() => {
      if (!loaded) {
        notice.style.display = 'block';
        fallback.style.display = 'block';
      }
    }, 5000);

    // 初始更新
    update();
  </script>
</body>
</html>
